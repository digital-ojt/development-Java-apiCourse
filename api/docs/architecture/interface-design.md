# ãƒ‰ãƒ­ãƒ¼ãƒ³åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆæ›¸

## ğŸ“‹ æ–‡æ›¸æ¦‚è¦

| é …ç›®       | å†…å®¹                                            |
| ---------- | ----------------------------------------------- |
| æ–‡æ›¸å     | ãƒ‰ãƒ­ãƒ¼ãƒ³åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆæ›¸ |
| ä½œæˆæ—¥     | 2024 å¹´ 12 æœˆ 15 æ—¥                             |
| æœ€çµ‚æ›´æ–°æ—¥ | 2024 å¹´ 12 æœˆ 15 æ—¥                             |
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | 1.1.0                                           |
| ä½œæˆè€…     | Development Team                                |
| æ‰¿èªè€…     | System Architect                                |

## ğŸ¯ å¯¾è±¡èª­è€…

- ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆ
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºãƒãƒ¼ãƒ 
- å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æºæ‹…å½“
- ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚¿ãƒ¼

---

## 1. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆæ¦‚è¦

### 1.1 è¨­è¨ˆæ–¹é‡

#### 1.1.1 åŸºæœ¬åŸå‰‡

- **REST API**: HTTP/HTTPS ãƒ™ãƒ¼ã‚¹ã®æ¨™æº–çš„ãª REST API ã‚’æ¡ç”¨
- **JSON å½¢å¼**: ãƒ‡ãƒ¼ã‚¿äº¤æ›ã¯ JSON å½¢å¼ã‚’æ¨™æº–ã¨ã™ã‚‹
- **åŒæœŸå‡¦ç†**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åœ¨åº«æ›´æ–°ã®ãŸã‚åŒæœŸ API æ–¹å¼ã‚’æ¡ç”¨
- **ã¹ãç­‰æ€§**: é‡è¤‡å‡¦ç†ã¸ã®å¯¾å¿œï¼ˆå†ªç­‰ã‚­ãƒ¼ã«ã‚ˆã‚‹é‡è¤‡æ’é™¤ï¼‰
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: æ¨™æº–çš„ãª HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

#### 1.1.2 API è¨­è¨ˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå‘½å**: RESTful ãªå‘½åè¦å‰‡ï¼ˆè¤‡æ•°å½¢ãƒªã‚½ãƒ¼ã‚¹åï¼‰
- **HTTP ãƒ¡ã‚½ãƒƒãƒ‰**: GETï¼ˆå‚ç…§ï¼‰ã€POSTï¼ˆä½œæˆï¼‰
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹çµ±ä¸€**: æˆåŠŸãƒ»ã‚¨ãƒ©ãƒ¼å…±ã«çµ±ä¸€ã•ã‚ŒãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°**: URL ãƒ‘ã‚¹ã«ã‚ˆã‚‹ API ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼ˆ/api/v1/ï¼‰

### 1.2 å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æºæ¦‚è¦

#### 1.2.1 é€£æºå¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ 

| ã‚·ã‚¹ãƒ†ãƒ å   | é€£æºæ–¹å‘ | ä¸»è¦ãƒ‡ãƒ¼ã‚¿                           | æ›´æ–°é »åº¦     |
| ------------ | -------- | ------------------------------------ | ------------ |
| **è³¼è²·æ‹…å½“** | åŒæ–¹å‘   | éƒ¨å“å…¥è·æƒ…å ±ã€å…¥è·å–æ¶ˆæƒ…å ±ã€åœ¨åº«æƒ…å ± | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  |
| **ç”Ÿç”£æ‹…å½“** | åŒæ–¹å‘   | ç”Ÿç”£æŒ‡ç¤ºã€è£½å“å…¥åº«æƒ…å ±ã€åœ¨åº«æƒ…å ±     | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  |
| **è²©å£²æ‹…å½“** | åŒæ–¹å‘   | è£½å“å‡ºè·æƒ…å ±ã€å‡ºè·å–æ¶ˆæƒ…å ±ã€åœ¨åº«æƒ…å ± | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  |

#### 1.2.2 åœ¨åº«ç®¡ç†åŸºæœ¬ãƒ•ãƒ­ãƒ¼å¯¾å¿œ

æ¥­å‹™è¦ä»¶æ›¸ã®åœ¨åº«ç®¡ç†åŸºæœ¬ãƒ•ãƒ­ãƒ¼ã«åŸºã¥ã API é€£æºï¼š

```mermaid
sequenceDiagram
    participant è³¼è²·æ‹…å½“
    participant ç”Ÿç”£æ‹…å½“
    participant è²©å£²æ‹…å½“
    participant åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

    %% éƒ¨å“ã®è³¼è²·ãƒ»å…¥è·
    è³¼è²·æ‹…å½“->>åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ : POST /api/v1/parts/receipt
    åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ -->>è³¼è²·æ‹…å½“: å‡¦ç†çµæœ

    %% éƒ¨å“ã®è³¼è²·ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    è³¼è²·æ‹…å½“->>åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ : POST /api/v1/parts/receipt/cancel
    åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ -->>è³¼è²·æ‹…å½“: å‡¦ç†çµæœ

    %% è£½å“è£½é€ è¨ˆç”»ã®å®Ÿè¡Œï¼ˆéƒ¨å“å‡ºåº«ï¼‰
    ç”Ÿç”£æ‹…å½“->>åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ : POST /api/v1/parts/issue
    åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ -->>ç”Ÿç”£æ‹…å½“: å‡¦ç†çµæœ

    %% è£½å“è£½é€ è¨ˆç”»ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    ç”Ÿç”£æ‹…å½“->>åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ : POST /api/v1/parts/issue/cancel
    åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ -->>ç”Ÿç”£æ‹…å½“: å‡¦ç†çµæœ

    %% è£½å“ã®å…¥åº«
    ç”Ÿç”£æ‹…å½“->>åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ : POST /api/v1/products/receipt
    åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ -->>ç”Ÿç”£æ‹…å½“: å‡¦ç†çµæœ

    %% è£½å“ã®å‡ºè·
    è²©å£²æ‹…å½“->>åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ : POST /api/v1/products/ship
    åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ -->>è²©å£²æ‹…å½“: å‡¦ç†çµæœ

    %% è£½å“ã®å‡ºè·ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    è²©å£²æ‹…å½“->>åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ : POST /api/v1/products/ship/cancel
    åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ -->>è²©å£²æ‹…å½“: å‡¦ç†çµæœ

    %% åœ¨åº«æƒ…å ±æä¾›
    è³¼è²·æ‹…å½“->>åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ : GET /api/v1/parts/stock
    åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ -->>è³¼è²·æ‹…å½“: éƒ¨å“åœ¨åº«æƒ…å ±

    ç”Ÿç”£æ‹…å½“->>åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ : GET /api/v1/parts/stock
    åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ -->>ç”Ÿç”£æ‹…å½“: éƒ¨å“åœ¨åº«æƒ…å ±

    ç”Ÿç”£æ‹…å½“->>åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ : GET /api/v1/products/stock
    åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ -->>ç”Ÿç”£æ‹…å½“: è£½å“åœ¨åº«æƒ…å ±

    è²©å£²æ‹…å½“->>åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ : GET /api/v1/products/stock
    åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ -->>è²©å£²æ‹…å½“: è£½å“åœ¨åº«æƒ…å ±
```

---

## 2. éƒ¨å“åœ¨åº«ç®¡ç† API

### 2.1 éƒ¨å“å…¥è·æƒ…å ±å—ä¿¡ API

#### 2.1.1 API æ¦‚è¦

è³¼è²·æ‹…å½“ã‹ã‚‰éƒ¨å“ã®å…¥è·æƒ…å ±ã‚’å—ä¿¡ã—ã€éƒ¨å“åœ¨åº«ã‚’æ›´æ–°ã—ã¾ã™ã€‚

- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/v1/parts/receipt`
- **èªè¨¼**: JWT Bearer Token
- **æ¨©é™**: ADMIN, OPERATOR

#### 2.1.2 ãƒªã‚¯ã‚¨ã‚¹ãƒˆä»•æ§˜

**HTTP ãƒ˜ãƒƒãƒ€ãƒ¼**

```http
Content-Type: application/json
Authorization: Bearer <JWT_TOKEN>
X-Idempotency-Key: <UNIQUE_KEY>
```

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**

```json
{
  "receipt_id": "RCP-2024-001234",
  "receipt_date": "2024-12-15T10:30:00Z",
  "center_code": "CTR001",
  "items": [
    {
      "stock_code": "PRT-FRAME-001",
      "stock_name": "ãƒ‰ãƒ­ãƒ¼ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆã‚«ãƒ¼ãƒœãƒ³è£½ï¼‰",
      "category_code": "CAT-FRAME",
      "received_quantity": 50,
      "unit": "å€‹",
      "unit_cost": 15000,
      "lot_number": "LOT-2024-1215-001",
      "supplier_code": "SUP001",
      "supplier_name": "éƒ¨å“ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼æ ªå¼ä¼šç¤¾",
      "part_number": "FRAME-CB-001",
      "manufacturer": "ã‚«ãƒ¼ãƒœãƒ³ãƒ†ãƒƒã‚¯æ ªå¼ä¼šç¤¾",
      "expiry_date": "2026-12-15",
      "remarks": "å“è³ªæ¤œæŸ»æ¸ˆ"
    }
  ],
  "operator": "purchase_user_001",
  "remarks": "å¹´æœ«åœ¨åº«è£œå……åˆ†"
}
```

#### 2.1.3 ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä»•æ§˜

**æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ200 OKï¼‰**

```json
{
  "status": "success",
  "message": "éƒ¨å“å…¥è·å‡¦ç†ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ",
  "data": {
    "receipt_id": "RCP-2024-001234",
    "processed_at": "2024-12-15T10:30:15Z",
    "processed_items": [
      {
        "stock_code": "PRT-FRAME-001",
        "before_stock": 25,
        "after_stock": 75,
        "processed_quantity": 50,
        "status": "success"
      }
    ]
  }
}
```

#### 2.1.4 å‡¦ç†ä»•æ§˜ï¼ˆTODO: è©³ç´°è¨­è¨ˆæ›¸ã«ç§»å‹•ï¼‰

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**

1. **å…¥åŠ›å€¤æ¤œè¨¼**

   - å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯ï¼ˆreceipt_id, center_code, items ãªã©ï¼‰
   - center_code ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯ï¼ˆcenter_infos ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
   - category_code ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯ï¼ˆparts_categories ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

2. **éƒ¨å“åœ¨åº«ã®å‡¦ç†**

   - `parts_stock` ãƒ†ãƒ¼ãƒ–ãƒ«ã§ `stock_code` ã«ã‚ˆã‚‹æ¤œç´¢
   - **æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹å ´åˆ:**
     - `current_stock` ã‚’ `received_quantity` åˆ†åŠ ç®—
     - `unit_cost`, `last_receipt_date` ãªã©ã‚’æ›´æ–°
   - **æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒãªã„å ´åˆ:**
     - æ–°è¦ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ
     - `center_code` â†’ `center_id` ã«å¤‰æ›
     - `category_code` â†’ `category_id` ã«å¤‰æ›
     - `current_stock` = `received_quantity` ã§åˆæœŸåŒ–

3. **å±¥æ­´ã®è¨˜éŒ²**

   - `parts_warehouse_history` ãƒ†ãƒ¼ãƒ–ãƒ«ã«å…¥è·å±¥æ­´ã‚’è¨˜éŒ²
   - `operation_type` = 'RECEIPT'
   - `reference_system` = 'PURCHASE'
   - `quantity_change` = `received_quantity` (æ­£ã®å€¤)

4. **å†ªç­‰æ€§ã®ç¢ºä¿**
   - `X-Idempotency-Key` ã«ã‚ˆã‚‹é‡è¤‡å‡¦ç†é˜²æ­¢

### 2.2 éƒ¨å“å…¥è·å–æ¶ˆ API

#### 2.2.1 API æ¦‚è¦

è³¼è²·ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®å…¥è·å–æ¶ˆå‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚

- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/v1/parts/receipt/cancel`
- **èªè¨¼**: JWT Bearer Token
- **æ¨©é™**: ADMIN, OPERATOR

#### 2.2.2 ãƒªã‚¯ã‚¨ã‚¹ãƒˆä»•æ§˜

```json
{
  "cancel_id": "CAN-2024-001234",
  "original_receipt_id": "RCP-2024-001234",
  "cancel_date": "2024-12-15T15:30:00Z",
  "cancel_reason": "ç™ºæ³¨ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã®ãŸã‚",
  "items": [
    {
      "stock_code": "PRT-FRAME-001",
      "cancel_quantity": 50
    }
  ],
  "operator": "purchase_user_001"
}
```

### 2.3 éƒ¨å“å‡ºåº«ï¼ˆç”Ÿç”£æŒ‡ç¤ºï¼‰API

#### 2.3.1 API æ¦‚è¦

ç”Ÿç”£æ‹…å½“ã‹ã‚‰ã®è£½é€ æŒ‡ç¤ºã‚’å—ä¿¡ã—ã€å¿…è¦éƒ¨å“ã‚’å‡ºåº«ã—ã¾ã™ã€‚

- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/v1/parts/issue`
- **èªè¨¼**: JWT Bearer Token
- **æ¨©é™**: ADMIN, OPERATOR

#### 2.3.2 ãƒªã‚¯ã‚¨ã‚¹ãƒˆä»•æ§˜

```json
{
  "production_order_id": "PO-2024-005678",
  "production_date": "2024-12-15T08:00:00Z",
  "product_code": "DRONE-AGRI-001",
  "production_quantity": 10,
  "center_code": "CTR001",
  "items": [
    {
      "stock_code": "PRT-FRAME-001",
      "required_quantity": 10,
      "manufacturing_lot": "LOT-PROD-2024-1215-001"
    },
    {
      "stock_code": "PRT-MOTOR-001",
      "required_quantity": 40,
      "manufacturing_lot": "LOT-PROD-2024-1215-001"
    }
  ],
  "operator": "production_user_001"
}
```

### 2.4 éƒ¨å“å‡ºåº«å–æ¶ˆ API

#### 2.4.1 API æ¦‚è¦

è£½é€ è¨ˆç”»å¤‰æ›´ãƒ»ä¸­æ­¢æ™‚ã®éƒ¨å“åœ¨åº«å¾©æ—§å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚

- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/v1/parts/issue/cancel`
- **èªè¨¼**: JWT Bearer Token
- **æ¨©é™**: ADMIN, OPERATOR

#### 2.4.2 ãƒªã‚¯ã‚¨ã‚¹ãƒˆä»•æ§˜

```json
{
  "cancel_id": "PC-CAN-2024-005678",
  "original_production_order_id": "PO-2024-005678",
  "cancel_date": "2024-12-15T16:00:00Z",
  "cancel_reason": "è¨­è¨ˆå¤‰æ›´ã®ãŸã‚è£½é€ ä¸­æ­¢",
  "items": [
    {
      "stock_code": "PRT-FRAME-001",
      "restore_quantity": 5
    }
  ],
  "operator": "production_user_001"
}
```

### 2.5 éƒ¨å“åœ¨åº«æƒ…å ±å–å¾— API

#### 2.5.1 API æ¦‚è¦

éƒ¨å“åœ¨åº«æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚

- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/v1/parts/stock`
- **èªè¨¼**: JWT Bearer Token
- **æ¨©é™**: ADMIN, OPERATOR, VIEWER

#### 2.5.2 ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```
GET /api/v1/parts/stock?center_code=CTR001&category_code=CAT-FRAME&stock_code=PRT-FRAME-001
```

#### 2.5.3 ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä»•æ§˜

```json
{
  "status": "success",
  "data": [
    {
      "stock_code": "PRT-FRAME-001",
      "stock_name": "ãƒ‰ãƒ­ãƒ¼ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆã‚«ãƒ¼ãƒœãƒ³è£½ï¼‰",
      "category_name": "ãƒ•ãƒ¬ãƒ¼ãƒ ",
      "center_name": "ãƒ¡ã‚¤ãƒ³ã‚»ãƒ³ã‚¿ãƒ¼",
      "current_stock": 75,
      "safety_stock": 50,
      "max_stock": 200,
      "unit": "å€‹",
      "unit_cost": 15000,
      "alert_status": "NORMAL"
    }
  ]
}
```

---

## 3. è£½å“åœ¨åº«ç®¡ç† API

### 3.1 è£½å“å…¥åº«ï¼ˆè£½é€ å®Œäº†ï¼‰API

#### 3.1.1 API æ¦‚è¦

è£½é€ å®Œäº†ãƒ»å“è³ªæ¤œæŸ»åˆæ ¼å¾Œã®è£½å“å…¥åº«å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚

- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/v1/products/receipt`
- **èªè¨¼**: JWT Bearer Token
- **æ¨©é™**: ADMIN, OPERATOR

#### 3.1.2 ãƒªã‚¯ã‚¨ã‚¹ãƒˆä»•æ§˜

```json
{
  "production_completion_id": "PC-2024-005678",
  "completion_date": "2024-12-15T18:00:00Z",
  "production_order_id": "PO-2024-005678",
  "stock_code": "DRONE-AGRI-001",
  "stock_name": "è¾²æ¥­ç”¨ãƒ‰ãƒ­ãƒ¼ãƒ³ï¼ˆæ¨™æº–ä»•æ§˜ï¼‰",
  "category_code": "CAT-AGRI",
  "completed_quantity": 10,
  "passed_quantity": 10,
  "center_code": "CTR001",
  "unit": "å°",
  "unit_cost": 400000,
  "product_model": "AGRI-STD-V1",
  "product_version": "1.0",
  "weight_kg": 2.5,
  "quality_check": {
    "inspector": "qc_user_001",
    "inspection_date": "2024-12-15T17:30:00Z",
    "inspection_result": "PASS"
  },
  "manufacturing_lot": "LOT-PROD-2024-1215-001",
  "serial_numbers": ["DRN-AGRI-240001", "DRN-AGRI-240002"],
  "operator": "production_user_001"
}
```

### 3.2 è£½å“å‡ºè· API

#### 3.2.1 API æ¦‚è¦

è²©å£²æ‹…å½“ã‹ã‚‰ã®å‡ºè·æŒ‡ç¤ºã‚’å—ä¿¡ã—ã€è£½å“åœ¨åº«ã‚’æ¸›ç®—ã—ã¾ã™ã€‚

- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/v1/products/ship`
- **èªè¨¼**: JWT Bearer Token
- **æ¨©é™**: ADMIN, OPERATOR

#### 3.2.2 ãƒªã‚¯ã‚¨ã‚¹ãƒˆä»•æ§˜

```json
{
  "shipment_id": "SHIP-2024-007890",
  "shipment_date": "2024-12-15T14:00:00Z",
  "customer_code": "CUST001",
  "center_code": "CTR001",
  "items": [
    {
      "stock_code": "DRONE-AGRI-001",
      "shipment_quantity": 3,
      "unit_price": 450000
    }
  ],
  "operator": "sales_user_001"
}
```

### 3.3 è£½å“å‡ºè·å–æ¶ˆ API

#### 3.3.1 API æ¦‚è¦

å‡ºè·ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®è£½å“åœ¨åº«å¾©æ—§å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚

- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/v1/products/ship/cancel`
- **èªè¨¼**: JWT Bearer Token
- **æ¨©é™**: ADMIN, OPERATOR

#### 3.3.2 ãƒªã‚¯ã‚¨ã‚¹ãƒˆä»•æ§˜

```json
{
  "cancel_id": "SHIP-CAN-2024-007890",
  "original_shipment_id": "SHIP-2024-007890",
  "cancel_date": "2024-12-15T16:30:00Z",
  "cancel_reason": "é¡§å®¢éƒ½åˆã«ã‚ˆã‚‹ã‚­ãƒ£ãƒ³ã‚»ãƒ«",
  "items": [
    {
      "stock_code": "DRONE-AGRI-001",
      "cancel_quantity": 3
    }
  ],
  "operator": "sales_user_001"
}
```

### 3.4 è£½å“åœ¨åº«æƒ…å ±å–å¾— API

#### 3.4.1 API æ¦‚è¦

è£½å“åœ¨åº«æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚

- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/v1/products/stock`
- **èªè¨¼**: JWT Bearer Token
- **æ¨©é™**: ADMIN, OPERATOR, VIEWER

#### 3.4.2 ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```
GET /api/v1/products/stock?center_code=CTR001&category_code=CAT-AGRI&stock_code=DRONE-AGRI-001
```

#### 3.4.3 ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä»•æ§˜

```json
{
  "status": "success",
  "data": [
    {
      "stock_code": "DRONE-AGRI-001",
      "stock_name": "è¾²æ¥­ç”¨ãƒ‰ãƒ­ãƒ¼ãƒ³ï¼ˆæ¨™æº–ä»•æ§˜ï¼‰",
      "category_name": "è¾²æ¥­ç”¨",
      "center_name": "ãƒ¡ã‚¤ãƒ³ã‚»ãƒ³ã‚¿ãƒ¼",
      "current_stock": 22,
      "safety_stock": 10,
      "max_stock": 50,
      "unit": "å°",
      "unit_cost": 400000,
      "alert_status": "NORMAL"
    }
  ]
}
```

---

## 4. å…±é€šã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 4.1 ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å®šç¾©

| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰         | HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | èª¬æ˜               |
| -------------------- | --------------- | ------------------ |
| `SUCCESS`            | 200             | æ­£å¸¸å‡¦ç†å®Œäº†       |
| `INVALID_REQUEST`    | 400             | ãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼ä¸æ­£ |
| `UNAUTHORIZED`       | 401             | èªè¨¼ã‚¨ãƒ©ãƒ¼         |
| `FORBIDDEN`          | 403             | æ¨©é™ä¸è¶³           |
| `RESOURCE_NOT_FOUND` | 404             | ãƒªã‚½ãƒ¼ã‚¹æœªå­˜åœ¨     |
| `DUPLICATE_REQUEST`  | 409             | é‡è¤‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆ     |
| `INSUFFICIENT_STOCK` | 422             | åœ¨åº«ä¸è¶³           |
| `INTERNAL_ERROR`     | 500             | ã‚·ã‚¹ãƒ†ãƒ å†…éƒ¨ã‚¨ãƒ©ãƒ¼ |

### 4.2 ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹çµ±ä¸€å½¢å¼

```json
{
  "status": "error",
  "message": "ã‚¨ãƒ©ãƒ¼ã®æ¦‚è¦èª¬æ˜",
  "error_code": "ERROR_CODE",
  "details": "è©³ç´°ãªã‚¨ãƒ©ãƒ¼å†…å®¹",
  "timestamp": "2024-12-15T10:30:15Z"
}
```

### 4.3 ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

#### 4.3.1 åœ¨åº«ä¸è¶³ã‚¨ãƒ©ãƒ¼ï¼ˆ422ï¼‰

```json
{
  "status": "error",
  "message": "åœ¨åº«ä¸è¶³ã®ãŸã‚å‡ºåº«ã§ãã¾ã›ã‚“",
  "error_code": "INSUFFICIENT_STOCK",
  "details": "stock_code: PRT-FRAME-001 ã®ç¾åœ¨åœ¨åº«: 5å€‹ã€è¦æ±‚æ•°é‡: 10å€‹",
  "timestamp": "2024-12-15T10:30:15Z"
}
```

#### 4.3.2 ãƒªã‚½ãƒ¼ã‚¹æœªå­˜åœ¨ã‚¨ãƒ©ãƒ¼ï¼ˆ404ï¼‰

```json
{
  "status": "error",
  "message": "æŒ‡å®šã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
  "error_code": "RESOURCE_NOT_FOUND",
  "details": "center_code: CTR999 ã¯å­˜åœ¨ã—ã¾ã›ã‚“",
  "timestamp": "2024-12-15T10:30:15Z"
}
```

#### 4.3.3 å…¥åŠ›å€¤ä¸æ­£ã‚¨ãƒ©ãƒ¼ï¼ˆ400ï¼‰

```json
{
  "status": "error",
  "message": "ãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼ãŒä¸æ­£ã§ã™",
  "error_code": "INVALID_REQUEST",
  "details": "required field 'stock_name' is missing",
  "timestamp": "2024-12-15T10:30:15Z"
}
```

---

## 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

### 5.1 èªè¨¼ãƒ»èªå¯

#### 5.1.1 JWT èªè¨¼

- **ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™**: 24 æ™‚é–“
- **ç½²åã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **: RS256

#### 5.1.2 æ¨©é™ãƒ¬ãƒ™ãƒ«

| æ¨©é™ãƒ¬ãƒ™ãƒ« | å®Ÿè¡Œå¯èƒ½æ“ä½œ                                       |
| ---------- | -------------------------------------------------- |
| ADMIN      | å…¨æ“ä½œå¯èƒ½                                         |
| OPERATOR   | åœ¨åº«æ›´æ–°æ“ä½œï¼ˆå…¥è·ãƒ»å‡ºåº«ãƒ»å…¥åº«ãƒ»å‡ºè·ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰ |
| VIEWER     | åœ¨åº«æƒ…å ±å‚ç…§ã®ã¿                                   |

### 5.2 é€šä¿¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **TLS ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.2 ä»¥ä¸Š
- **API ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: Rate Limitingï¼ˆ1 åˆ†é–“ã« 60 ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰
- **å…¥åŠ›å€¤æ¤œè¨¼**: å³å¯†ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

---

## 6. é‹ç”¨ãƒ»ç›£è¦–

### 6.1 ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/v1/health`
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

```json
{
  "status": "UP",
  "components": {
    "database": {
      "status": "UP"
    }
  },
  "timestamp": "2024-12-15T10:30:15Z"
}
```

### 6.2 API ç›£è¦–é …ç›®

- **å¿œç­”æ™‚é–“**: å¹³å‡ãƒ»æœ€å¤§å¿œç­”æ™‚é–“
- **ã‚¨ãƒ©ãƒ¼ç‡**: 4xxãƒ»5xx ã‚¨ãƒ©ãƒ¼ã®ç™ºç”Ÿç‡
- **åœ¨åº«æ•´åˆæ€§**: API å‡¦ç†å‰å¾Œã®åœ¨åº«æ•°ãƒã‚§ãƒƒã‚¯

---

## ğŸ“‹ æ‰¿èªå±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ›´æ–°æ—¥     | æ›´æ–°è€…           | æ‰¿èªè€…           | æ›´æ–°å†…å®¹                                      |
| ---------- | ---------- | ---------------- | ---------------- | --------------------------------------------- |
| 1.0.0      | 2024-12-15 | Development Team | System Architect | æ¥­å‹™è¦ä»¶åŸºæœ¬ãƒ•ãƒ­ãƒ¼ã«åŸºã¥ã API é€£æºã®åˆç‰ˆä½œæˆ |
| 1.1.0      | 2024-12-15 | Development Team | System Architect | ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆã«åŸºã¥ããƒªã‚¯ã‚¨ã‚¹ãƒˆ Body ã®è©³ç´°åŒ–  |

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [æ¥­å‹™è¦ä»¶æ›¸](../../../docs/requirements/business-requirements.md)
- [ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆæ›¸](../../../docs/architecture/data-design.md)
- [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦æ›¸](./system-overview.md)
